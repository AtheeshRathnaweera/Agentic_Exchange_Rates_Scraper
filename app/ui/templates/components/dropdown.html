{% macro dropdown(xModel, options, showEmpty=true, emptyLabel="Select an option", resetEvent="reset") %}
<div x-data='{
      open: false,
      options: {{ options|default([], true) | tojson | safe}},
      originalEmptyLabel: "{{ emptyLabel }}",
      get displayValue() {
        if (!{{ xModel }}) return "";
        
        // Find the option that matches the selected value
        const selectedOption = this.options.find(option => {
          if (typeof option === "object") {
            return option.id === {{ xModel }};
          }
          return option === {{ xModel }};
        });
        
        // Return the display value or fallback to selected
        if (selectedOption) {
          return typeof selectedOption === "object" ? selectedOption.value : selectedOption;
        }
        return this.selected;
      },
      updateSelection(value) {
        {{ xModel }} = value;
        this.open = false;
      },
    }' @{{ resetEvent }}.window="{{ xModel }} = ''; open = false" @click.outside="open = false"
  class="relative w-full min-w-0">
  <button @click="open = !open" type="button"
    class="flex items-center justify-between gap-2 border px-3 py-2 text-sm transition-[color,box-shadow] outline-none focus-visible:ring-[3px] w-full h-11 bg-slate-900/50 border-cyan-700/30 text-white focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 rounded-xl min-w-0">
    <span x-text="displayValue || '{{ emptyLabel }}'"
      class="opacity-60 truncate text-left flex-1 min-w-0 overflow-hidden"
      x-bind:class="{ 'opacity-100': {{ xModel }} }"></span>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="lucide lucide-chevron-down size-4 opacity-50 shrink-0 ml-auto" aria-hidden="true">
      <path d="m6 9 6 6 6-6"></path>
    </svg>
  </button>
  <div x-show="open" @click.away="open = false"
    class="dropdown-scroll overflow-y-auto max-h-48 sm:max-h-64 absolute left-0 top-full mt-2 w-full bg-slate-900/90 border border-cyan-700/30 rounded-xl shadow-lg z-20"
    style="display: none;">
    <ul class="py-2">
      {% if showEmpty %}
      <li>
        <button @click="updateSelection('')"
          class="w-full text-left px-4 py-2 hover:bg-cyan-900/30 text-slate-400 truncate">
          {{ emptyLabel }}
        </button>
      </li>
      {% endif %}
      <template x-for="option in options" :key="typeof option === 'object' ? option.id : option">
        <li>
          <button @click="updateSelection(typeof option === 'object' ? option.id : option)"
            class="w-full text-left px-4 py-2 hover:bg-cyan-900/30 text-nowrap"
            x-text="typeof option === 'object' ? option.value : option"
            :class="{ 'bg-cyan-900/50 text-cyan-300': {{ xModel }} === (typeof option === 'object' ? option.id : option) }">
          </button>
        </li>
      </template>
    </ul>
  </div>
</div>
{% endmacro %}